# === –°–±–æ—Ä–∫–∞ React (Vite + TypeScript) ===
FROM node:20 AS build
WORKDIR /app

# –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–æ–≥—É—é SSL-–ø—Ä–æ–≤–µ—Ä–∫—É (—Ñ–∏–∫—Å –¥–ª—è SELF_SIGNED_CERT_IN_CHAIN)
RUN npm config set strict-ssl false
RUN npm config set registry https://registry.npmjs.org/

# –ö–æ–ø–∏—Ä—É–µ–º package.json –∏ package-lock.json
COPY package*.json ./

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è dev)
RUN npm ci || npm install --include=dev

# –ö–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞
COPY . .

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
RUN npm run build

# === Production —Å–µ—Ä–≤–µ—Ä (Nginx) ===
FROM nginx:1.25-alpine

# –ö–æ–ø–∏—Ä—É–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
COPY --from=build /app/dist /usr/share/nginx/html

# üîπ –î–û–ë–ê–í–õ–Ø–ï–ú –ö–ê–†–¢–ò–ù–ö–ò –ò–ó src/images
COPY --from=build /app/src/images /usr/share/nginx/html/images

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–Ω—Ñ–∏–≥ Nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
